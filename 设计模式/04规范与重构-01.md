### 重构的目的、对象、时机和方法

- __重构的目的：为什么重构（why）？__

  对于项目来言，重构可以保持代码质量持续处于一个可控状态，不至于腐化到无可救药的地步。对于个人而言，重构非常锻炼一个人的代码能力，并且是一件非常有成就感的事情。它是我们学习的经典设计思想、原则、模式、编程规范等理论知识的练兵场。

- __重构的对象：重构什么（what）？__

  按照重构的规模，我们可以将重构大致分为大规模高层次的重构和小规模低层次的重构。大规模高层次重构包括对代码分层、模块化、解耦、梳理类之间的交互关系、抽象复用组件等等。这部分工作利用的更多的是比较抽象、比较顶层的设计思想、原则、模式。小规模低层次的重构包括规范命名、注释、修正函数参数过多、消除超大类、提取重复代码等等编程细节问题，主要是针对类、函数级别的重构。小规模低层次的重构更多的是利用编码规范这一理论知识。

- __重构的时机：什么时候重构（when）？__

  我反复强调，我们一定要建立持续重构意识，把重构作为开发必不可少的部分，融入到日常开发中，而不是等到代码出现很大问题的时候，再大刀阔斧地重构。

- __重构的方法：如何重构（how）？__

  大规模高层次的重构难度比较大，需要组织、有计划地进行，分阶段地小步快跑，时刻让代码处于一个可运行的状态。而小规模低层次的重构，因为影响范围小，改动耗时短，所以，只要你愿意并且有时间，随时随地都可以去做。

---

### 单元测试（Unit Testing）

- __什么是单元测试？__

  单元测试是代码层面的测试，由研发自己来编写，用于测试“自己”编写的代码的逻辑的正确性。单元测试顾名思义是测试一个“单元”，有别于集成测试，这个“单元”一般是类或函数，而不是模块或者系统。

- __为什么要写单元测试？__
  - 单元测试能有效地帮你发现代码中的 bug
  - 写单元测试能帮你发现代码设计上的问题
  - 单元测试是对集成测试的有力补充
  - 写单元测试的过程本身就是代码重构的过程
  - 阅读单元测试能帮助你快速熟悉代码
  - 单元测试是 TDD 可落地执行的改进方案

- __如何编写单元测试？__

  写单元测试就是针对代码设计各种测试用例，以覆盖各种输入、异常、边界情况，并将其翻译成代码。我们可以利用一些测试框架来简化单元测试的编写。除此之外，对于单元测试，我们需要建立以下正确的认知：

  - 编写单元测试尽管繁琐，但并不是太耗时；
  - 我们可以稍微放低对单元测试代码质量的要求；
  - 覆盖率作为衡量单元测试质量的唯一标准是不合理的；
  - 单元测试不要依赖被测代码的具体实现逻辑；
  - 单元测试框架无法测试，多半是因为代码的可测试性不好。

- __单元测试为何难落地执行？__

  一方面，写单元测试本身比较繁琐，技术挑战不大，很多程序员不愿意去写；另一方面，国内研发比较偏向“快、糙、猛”，容易因为开发进度紧，导致单元测试的执行虎头蛇尾。最后，关键问题还是团队没有建立对单元测试正确的认识，觉得可有可无，单靠督促很难执行得很好。

写一个二分查找的变体算法，查找递增数组中第一个大于等于某个给定值的元素:

```java
public int binarySearch(int[] nums, int target) {
    int low = 0;
    int high = nums.length - 1;
    while (low <= high) {
        int mid = low + ((high - low) >>> 1);
        int num = nums[mid];
        if (num >= target) {
            if (mid == 0 || nums[mid - 1] < target) {
                return mid;
            } else {
                high = mid - 1;
            }
        } else {
            low = mid + 1;
        }
    }
    return -1;
}
```

